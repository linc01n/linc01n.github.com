
<!DOCTYPE HTML>
<html manifest="/cache.manifest">
<head>
	<meta charset="utf-8">
	<title>Coding, Coding, Coding</title>
	<meta name="author" content="Lincoln Lee">

	
	<meta name="description" content="Oct 8th, 2013 development, graph, ruby Using gruff graphing library Requirement I played around with gruff today. The final result is really &hellip;">
	

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="/atom.xml" rel="alternate" title="Coding, Coding, Coding" type="application/atom+xml">
	
	<link rel="canonical" href="http://linc01n.github.io/">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">

  <link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,400,700' rel='stylesheet' type='text/css'>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
  <link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
  <link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<script type="text/javascript">
// Check if a new cache is available on page load.
window.addEventListener('load', function(e) {
  window.applicationCache.addEventListener('updateready', function(e) {
    if (window.applicationCache.status == window.applicationCache.UPDATEREADY) {
      window.applicationCache.swapCache();
       window.location.reload();
    }
  }, false);
}, false);
</script>
</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
			<header id="header" class="inner"><div class="profilepic">
	<script src="/javascripts/md5.js"></script>
	<script type="text/javascript">
		document.write("<img src='http://www.gravatar.com/avatar/" + MD5("git@lincoln.hk") + "?s=160' alt='Profile Picture' style='width: 160px;'");
	</script>
</div>
<h1><a href="/">Lincoln Lee</a></h1>
<p class="subtitle">Backend Developer / DevOps</p>
<nav id="main-nav"><ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>
</nav>
<nav id="sub-nav">
	<div class="social">
		
		
		
		<a class="twitter" href="http://twitter.com/linc01n" title="Twitter">Twitter</a>
		
		
		<a class="github" href="https://github.com/linc01n" title="GitHub">GitHub</a>
		
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
</nav>
<br />
<hgroup>
  <h1><a href="/">Coding, Coding, Coding</a></h1>
  
    <h2>Mostly about web :)</h2>
  
</hgroup>
<br />
<br />
<section>
  <h3>Recent Posts</h3>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/10/08/using-gruff-graphing-library/">Using gruff graphing library</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/10/05/using-parallels-desktop-as-vagrant-provider/">Using Parallels Desktop as Vagrant Provider</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/06/28/add-google-webmaster-verification-in-octopress/">Add google webmaster verification in octopress</a>
      </li>
    
  </ul>
</section>

</header>
			</div>
		</div>
		<div class="mid-col">
			<div class="mid-col-container">
				<div id="content" class="inner">
<div itemscope itemtype="http://schema.org/Blog">


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-10-08T22:09:00+08:00" data-updated="true" itemprop="datePublished">Oct 8<span>th</span>, 2013</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/development/'>development</a>, <a class='category' href='/blog/categories/graph/'>graph</a>, <a class='category' href='/blog/categories/ruby/'>ruby</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/10/08/using-gruff-graphing-library/" itemprop="url">Using gruff graphing library</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<h3>Requirement</h3>

<p>I played around with <a href="https://github.com/topfunky/gruff">gruff</a> today. The final result is really impressive. Especially it can visualize data from your database in the way you want.</p>

<p>Before you install this gem. You need to install few extra things. They are <a href="http://www.imagemagick.org/script/index.php">imagemagick</a>, <a href="http://www.ghostscript.com/">ghostscript</a>. On Mac OSX you need to do</p>

<p><code>brew install imagemagick ghostscript</code></p>

<p>After installing both packages, you can run <code>bundle install</code></p>

<h3>Usage</h3>

<p>To generate a graph you need to</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s2">&quot;gruff&quot;</span>
</span><span class='line'><span class="nb">require</span> <span class="s2">&quot;date&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Create the graph object</span>
</span><span class='line'><span class="n">g</span> <span class="o">=</span> <span class="ss">Gruff</span><span class="p">:</span><span class="ss">:Line</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Set the title</span>
</span><span class='line'><span class="n">g</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;My First Graph&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Let say we have a data hash</span>
</span><span class='line'><span class="c1"># The element is like {Date =&gt; Integer}</span>
</span><span class='line'>
</span><span class='line'><span class="n">today</span>     <span class="o">=</span> <span class="no">Date</span><span class="o">.</span><span class="n">today</span>
</span><span class='line'><span class="n">yesterday</span> <span class="o">=</span> <span class="no">Date</span><span class="o">.</span><span class="n">today</span><span class="o">.</span><span class="n">prev_day</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="n">data</span> <span class="o">=</span> <span class="p">{</span> <span class="n">yesterday</span> <span class="o">=&gt;</span> <span class="mi">100</span><span class="p">,</span> <span class="n">today</span> <span class="o">=&gt;</span> <span class="mi">200</span><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># We need to set the x-axis labels</span>
</span><span class='line'><span class="c1"># It need to be a Hash { 0 =&gt; &quot;name 1&quot;, 1 =&gt; &quot;name 2&quot;, … }</span>
</span><span class='line'><span class="c1"># We need to do a little bit of data transform here.</span>
</span><span class='line'><span class="n">g</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="no">Hash</span><span class="o">[</span><span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="o">.</span><span class="n">size</span><span class="p">)</span><span class="o">.</span><span class="n">zip</span> <span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="o">.</span><span class="n">map</span><span class="p">{</span><span class="o">|</span><span class="n">day</span><span class="o">|</span> <span class="n">day</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%d %b&quot;</span><span class="p">)}</span><span class="o">]</span> <span class="c1"># =&gt; {0=&gt;&quot;07 Oct&quot;, 1=&gt;&quot;08 Oct&quot;}</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Then we need to set the y-axis, we need to give it a name</span>
</span><span class='line'><span class="n">g</span><span class="o">.</span><span class="n">data</span> <span class="ss">:Price</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">values</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Write the generated graph to a file</span>
</span><span class='line'><span class="n">g</span><span class="o">.</span><span class="n">write</span> <span class="s2">&quot;gruff.png&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is the generated graph:</p>

<p><img src="/images/gruff.png" alt="Generated Graph" /></p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-10-05T21:40:00+08:00" data-updated="true" itemprop="datePublished">Oct 5<span>th</span>, 2013</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/coding/'>coding</a>, <a class='category' href='/blog/categories/ruby/'>ruby</a>, <a class='category' href='/blog/categories/vagrant/'>vagrant</a>, <a class='category' href='/blog/categories/vm/'>vm</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/10/05/using-parallels-desktop-as-vagrant-provider/" itemprop="url">Using Parallels Desktop as Vagrant Provider</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<h3>Vagrant is great!</h3>

<h4>What is vagrant?</h4>

<p><a href="http://www.vagrantup.com/">Vagrant</a> provides easy to configure, reproducible, and portable work environments. In other words, It creates a VM for development.</p>

<p>I use vagrant to do my development in the past year. Slowly learning all the pros and cons of vagrant when using it for development. Vagrant use VirtualBox as a VM host. There is a problem about the license of the guest addition of VirtualBox. If I want to use it commercially I need to purchase a license from Oracle(USD50 for 100 end users). Problem is 100 licenses min buy.</p>

<h4>Vagrant can use VMWare as a host</h4>

<p>Later version of vagrant abstract the VM provider as a provider plugin. This open the possibility to support other hypervisor.</p>

<h3>I own a Parallels Desktop 8 license</h3>

<p>It would be great if I can use PD8 as my vagrant host. Now the dream came true. <a href="https://github.com/yshahin/vagrant-parallels">https://github.com/yshahin/vagrant-parallels</a>. Vagrant Parallels plugin!</p>

<p>I tested it for almost 2 days. Everything works fine. I can do <code>vagrant ssh</code> <code>vagrant up</code> <code>vagrant halt</code>.</p>

<p>The site provide one box for you to use. The box for vagrant-paralles is a bit special. I want Ubuntu 12.04.3 LTS for one of my project. So I decided to build the box myself.</p>

<h3>Veewee easy way to build vagrant box</h3>

<p><a href="https://github.com/jedi4ever/veewee">Veewee</a> is a tool for easily (and repeatedly) building custom Vagrant base boxes, KVMs, and virtual machine images.</p>

<p>Veewee supports parallels export 15 days ago. It got almost all the common linux distribution.</p>

<h3>Building my own parallels box is not that easy</h3>

<p>First, you need to install the parallels SDK for python. If you are using homebrew version of python you need to symlink the SDK separately.</p>

<p><code>ln -s /Library/Frameworks/ParallelsVirtualizationSDK.framework/Libraries/Python/2.7/prlsdkapi /usr/local/lib/python2.7/site-packages/</code></p>

<p>Then you need to create a definition for the box. I use</p>

<p><code>veewee parallels define 'ubuntu-12.04-lts' 'ubuntu-12.04.3-server-amd64'</code></p>

<p>In the definition directory edit the <em>definitions.rb</em> file. Remove virtualbox and vmware. We don&#8217;t need those since we are creating for PD.</p>

<p>Let&#8217;s build the box with</p>

<p><code>veewee parallels build 'ubuntu-12.04-lts' --workdir=/path/to/wd</code></p>

<p>Wait a while the os is installing. Here comes with a gotcha. If you get stuck in install grub-pc, you need to reboot you mac. I don&#8217;t know why but it works. I also found we cannot do unattended install of Parallels tools. After the build is complete, do not shutdown the instance. Install the tools using ssh with vagrant/vagrant login.</p>

<p>The last step of creating the box is</p>

<p><code>veewee parallels export 'ubuntu-1204-lts' --workdir=/path/to/wd</code></p>

<h3>Vagrant up</h3>

<p>So after importing the box, created the new Vagrantfile. We can start the vagrant box.</p>

<p><code>vagrant up --provider=paralles</code></p>

<p>Use the provider flag on the first time boot.</p>

<h3>Everything is just like VirtualBox</h3>

<p>The networking config in Vagrantfile seems still not support. But this plugin is only 0.0.4. We will see.</p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-06-28T19:34:00+08:00" data-updated="true" itemprop="datePublished">Jun 28<span>th</span>, 2013</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/blog/'>blog</a>, <a class='category' href='/blog/categories/google-webmaster/'>google webmaster</a>, <a class='category' href='/blog/categories/octopress/'>octopress</a>, <a class='category' href='/blog/categories/verification/'>verification</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/06/28/add-google-webmaster-verification-in-octopress/" itemprop="url">Add google webmaster verification in octopress</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<h3>Google Webmaster verification</h3>

<p>I deployed my blog on github. So I can&#8217;t use DNS verification. I used HTML verification. It require you to put a specific html file on your root directory.</p>

<h3>How to add the file in Octopress</h3>

<p>I tried to place the file in /public folder every time before I run <code>rake deploy</code> to deploy my blog. This method is too much trouble and sometime I will forget to do it.</p>

<p>To solve this problem, go to _config.yml file in Octopress.</p>

<p>Add this line:</p>

<p><code>include: ["googlexxxxxx.html"]</code></p>

<p>And place the googlexxxxxx.html file under source directory.</p>

<p>You can try to remove the whole public directory and run <code>rake generate</code>. You will see the google html file is also inside.</p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-06-13T23:16:00+08:00" data-updated="true" itemprop="datePublished">Jun 13<span>th</span>, 2013</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/ad-network/'>ad network</a>, <a class='category' href='/blog/categories/geo/'>geo</a>, <a class='category' href='/blog/categories/targeting/'>targeting</a>, <a class='category' href='/blog/categories/work/'>work</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/06/13/cloudflare-messup-with-our-geo-targeting-ad-serving/" itemprop="url">Cloudflare messup with our geo targeting ad serving</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<h3>Self-doubt on my code</h3>

<p>I have joined a local AD network company as a senior developer(who got out of college one year ago). I joined this company for more than half a year. Mainly working on cleaning the code and infrastructure. I redesign the AD selection algorithm and implement it. I have learned a lot from this practice. Geo targeting is one of the selection criteria.</p>

<p>I received a support ticket from our operation team last week. We have launched a new campaign targeting US internet user but we are recording HK IP address. The first thought that struck me was I messed up the implementation(some background information: my new algorithm is testing on production. There is no time for proxy shadowing or mock test. SHIP IT before test it!).</p>

<p>I rethink the whole logic in my head step-by-step. The truth is I don&#8217;t know what happen. Large scale production system is a beast. I still find myself clueless on other parts of the system.</p>

<p>I didn&#8217;t manage to figure out what happen so our team decided to checkout all the statistic we&#8217;ve got dig deeper to see what happen.</p>

<h3>Cloudflare is caching javascript</h3>

<p>I visited the publisher site and found out our script tag type become &#8216;text/rocketscript&#8217;. After some googling it is a thing called RocketLoader from Cloudflare.</p>

<p>This thing messes up with geo targeting for all of our ads. After some research, <a href="http://www.advertserve.com/blog/2013/04/cloudflare-and-rocketloader/">AdvretServe</a> and <a href="http://udinra.com/blog/google-adsense-cloudflare-issue-and-solution">Google Adsense</a> are also having this problem.</p>

<p>Our javascript content is different per request. Cloudflare execute our javascript and save it. I know static content should use CDN to speed up things. But some ad network is not using static js. I don&#8217;t know much but at least all the 3-rd party agency we worked with are using dynamic js.</p>

<h3>Solution (which is not really a solution)</h3>

<p>We need to ask publisher to disable Cloudflare. Cloudflare not only affect geotargeting campaign. We later find out that it also lower the publisher total ad serve. We are still investigating what&#8217;s the issue. But we will list Cloudflare as not compatible with our network.</p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-05-17T19:00:00+08:00" data-updated="true" itemprop="datePublished">May 17<span>th</span>, 2013</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/ops/'>ops</a>, <a class='category' href='/blog/categories/sysadmin/'>sysadmin</a>, <a class='category' href='/blog/categories/vpn/'>vpn</a>, <a class='category' href='/blog/categories/vps/'>vps</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/05/17/softether-on-vps-using-local-bridge/" itemprop="url">Softether on VPS using local bridge</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>This post continues on the last post about <a href="http://linc01n.github.io/blog/2013/03/19/softether-on-vps/">Softether setup on a VPS</a>.</p>

<h3>Problem on SecureNAT</h3>

<p>SecureNAT is a fairly simple way to setup Softether. You don&#8217;t need a lot of sysadmin skill and network understanding in order to get Softether up and running.</p>

<p>The problem is SecureNAT is a bit <strong>SLOW</strong>. I will show a comparison at the end of this article.</p>

<p>We can boost the performance using a local bridge.</p>

<h3>Softether using local bridge</h3>

<p>To start with you need Softether installed and setup. You can follow the guide on <a href="http://linc01n.github.io/blog/2013/03/19/softether-on-vps/">Softether on VPS</a></p>

<p>Just skip the last step &#8220;Enable the Virtual NAT&#8221;</p>

<h3>Local bridge Setup</h3>

<blockquote><p><strong>Network setup</strong></p>

<p>VPN Server IP: 192.168.7.1</p>

<p>VPN Client IP Range: 192.168.7.50-192.168.7.60</p>

<p>Tap Device name: tap_soft</p></blockquote>

<p>From here we go to the &#8220;Local Bridge Setting&#8221;</p>

<p><img src="/images/softether_local_bridge/local-bridge-setting.png" alt="Local Bridge Setting" /></p>

<p>First we choose the Virtual Hub. It should be only one for normal setup.</p>

<p>Then we check the tap device box.</p>

<p>After that we type in the name of the tap device(I use soft here for simplicity).</p>

<p><img src="/images/softether_local_bridge/create-local-bridge.png" alt="Create Local Bridge" /></p>

<p>After the creation of the local bridge we jump back to our server. And run</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># ifconfig tap_soft </span></code></pre></td></tr></table></div></figure>


<p>It should show you something similar to this</p>

<p><img src="/images/softether_local_bridge/check-on-the-sever.png" alt="Check on the server" /></p>

<p>Because we are not going to use SecureNAT and SecureDHCP. We need to install a DHCP server on our VPS. We are going to use dnsmasq as our DHCP server.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># apt-get install dnsmasq</span></code></pre></td></tr></table></div></figure>


<p>Now edit the /etc/dnsmasq.conf file. Add these 3 lines at the end.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>interface=tap_soft
</span><span class='line'>dhcp-range=tap_soft,192.168.7.50,192.168.7.60,12h
</span><span class='line'>dhcp-option=tap_soft,3,192.168.7.1</span></code></pre></td></tr></table></div></figure>


<p>The above 3 lines are used to enable the dhcp server on interface tap_soft.</p>

<p>Next step we need a new set of init script which will config tap interface for us when Softether start up.</p>

<figure class='code'><figcaption><span>/etc/init.d/vpnserver  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#!/bin/sh</span>
</span><span class='line'><span class="c">### BEGIN INIT INFO</span>
</span><span class='line'><span class="c"># Provides:          vpnserver</span>
</span><span class='line'><span class="c"># Required-Start:    $remote_fs $syslog</span>
</span><span class='line'><span class="c"># Required-Stop:     $remote_fs $syslog</span>
</span><span class='line'><span class="c"># Default-Start:     2 3 4 5</span>
</span><span class='line'><span class="c"># Default-Stop:      0 1 6</span>
</span><span class='line'><span class="c"># Short-Description: Start daemon at boot time</span>
</span><span class='line'><span class="c"># Description:       Enable Softether by daemon.</span>
</span><span class='line'><span class="c">### END INIT INFO</span>
</span><span class='line'><span class="nv">DAEMON</span><span class="o">=</span>/usr/local/vpnserver/vpnserver
</span><span class='line'><span class="nv">LOCK</span><span class="o">=</span>/var/lock/subsys/vpnserver
</span><span class='line'><span class="nv">TAP_ADDR</span><span class="o">=</span>192.168.7.1
</span><span class='line'>
</span><span class='line'><span class="nb">test</span> -x <span class="nv">$DAEMON</span> <span class="o">||</span> <span class="nb">exit </span>0
</span><span class='line'><span class="k">case</span> <span class="s2">&quot;$1&quot;</span> in
</span><span class='line'>start<span class="o">)</span>
</span><span class='line'><span class="nv">$DAEMON</span> start
</span><span class='line'>touch <span class="nv">$LOCK</span>
</span><span class='line'>sleep 1
</span><span class='line'>/sbin/ifconfig tap_soft <span class="nv">$TAP_ADDR</span>
</span><span class='line'>;;
</span><span class='line'>stop<span class="o">)</span>
</span><span class='line'><span class="nv">$DAEMON</span> stop
</span><span class='line'>rm <span class="nv">$LOCK</span>
</span><span class='line'>;;
</span><span class='line'>restart<span class="o">)</span>
</span><span class='line'><span class="nv">$DAEMON</span> stop
</span><span class='line'>sleep 3
</span><span class='line'><span class="nv">$DAEMON</span> start
</span><span class='line'>sleep 1
</span><span class='line'>/sbin/ifconfig tap_soft <span class="nv">$TAP_ADDR</span>
</span><span class='line'>;;
</span><span class='line'>*<span class="o">)</span>
</span><span class='line'><span class="nb">echo</span> <span class="s2">&quot;Usage: $0 {start|stop|restart}&quot;</span>
</span><span class='line'><span class="nb">exit </span>1
</span><span class='line'><span class="k">esac</span>
</span><span class='line'><span class="nb">exit </span>0
</span></code></pre></td></tr></table></div></figure>


<p>Then we need to enable NAT on linux server.</p>

<p>Add this file to /etc/sysctl.d/ to enable ipv4 forwarding.</p>

<figure class='code'><figcaption><span>/etc/sysctl.d/ipv4_forwarding.conf  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>net.ipv4.ip_forward <span class="o">=</span> 1
</span></code></pre></td></tr></table></div></figure>


<p>Apply the sysctl run</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># sysctl --system</span></code></pre></td></tr></table></div></figure>


<p>Then we add a POSTROUTING rule to iptables</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># iptables -t nat -A POSTROUTING -s 192.168.7.0/24 -j SNAT --to-source [YOUR VPS IP ADDRESS]</span></code></pre></td></tr></table></div></figure>


<p>To make our iptables rule survive after reboot install <code>iptables-persistent</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># apt-get install iptables-persistent</span></code></pre></td></tr></table></div></figure>


<p>After all the above setting, restart the vpnserver then we are good to go.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># /etc/init.d/vpnserver restart
</span><span class='line'># /etc/init.d/dnsmasq restart</span></code></pre></td></tr></table></div></figure>


<p>Comparison on SecureNAT and local bridge method.</p>

<p><img src="/images/softether_local_bridge/l2tp_bridge.png" alt="Speed test on local bridge" />
<img src="/images/softether_local_bridge/l2tp_SecureNAT.png" alt="Speed test on SecureNAT" /></p>

<h3>Conclusion</h3>

<p>Local bridge use far less CPU resources than SecureNAT. It is a bit trouble to setup but I think it is worth to use local bridge.</p>

<p>I would recommend <a href="https://clientarea.ramnode.com/aff.php?aff=319">Ramnode</a> as a VPS provider. Their VPS is speedy and support is amazing.</p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-03-24T12:49:00+08:00" data-updated="true" itemprop="datePublished">Mar 24<span>th</span>, 2013</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/paas/'>PaaS</a>, <a class='category' href='/blog/categories/loader-dot-io/'>loader.io</a>, <a class='category' href='/blog/categories/loading-test/'>loading test</a>, <a class='category' href='/blog/categories/rails/'>rails</a>, <a class='category' href='/blog/categories/sqale-dot-jp/'>sqale.jp</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/03/24/load-testing-on-sqale-dot-jp-single-container-for-static-page/" itemprop="url">Load testing on sqale.jp single container for static page</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>I met with some amazing developers from <a href="https://sqale.jp">Sqale.jp</a> when I attent <a href="http://rubyconf.tw/2012/">Ruby Conf TW 2012</a> last year.</p>

<p>Sqale is a japanese company compete with <a href="http://www.heroku.com/">Heroku</a> to provide developer friendly platform to host rails app.</p>

<p>Sqale is addressing some of the problems Heroku.</p>

<ol>
<li>Server location - Heroku servers are in US which is quite far away if the target audience are in APAC area.</li>
<li>SSH access

<blockquote><p>Since your app is spread across many dynos in the dyno manifold, there is no single place to SSH into. You deploy and manage apps, not servers.<a href="https://devcenter.heroku.com/articles/one-off-dynos#ssh-access">ref</a></p></blockquote></li>
<li>Slug size - Heroku limit it to a maximum 200MB.</li>
</ol>


<p>Sqale provides server in Tokyo and gives developer a LXC container to work with. You can run cron job on Sqale without any changes if you migrate from dedicate server. So the platform dependent is lesser than Heroku.</p>

<p>For slug size, Sqale do not have a concept of slug. They give you 2GB of disk space for one container.</p>

<h3>Pricing model</h3>

<p>Sqale is charge by number of containers. Each one is ¥940 per month which is around 10USD.</p>

<h2>How powerful is one container?</h2>

<p>I am still testing out Sqale. Before I use Sqale in production I need to know what&#8217;s my operation cost.</p>

<h3>Deploy a sample app</h3>

<p>I always want to try out <a href="https://github.com/github/swordfish">Swordfish</a>. So I deployed it to sqale. The process is not too hard. But therer are lack of english documentation. I can only just guess what the console mean and try my best. Support from sqale is really helpful.</p>

<h3>Static file test</h3>

<p>I don&#8217;t want to test dynamic content yet. So I created a blank index.html in public/ directory and see how their nginx perform.</p>

<h4>10 concurrent request warmup for 60 second</h4>

<div style="width: 600px;">
<iframe  style="overflow: hidden;" scrolling="no" width='600' height='300' frameborder='0' src='//share.loader.io/results/9fc6e5f2ac4f708b91a86095c13d8762/widget'></iframe>
<div style="width: 100%; text-align: right;">
<a href="http://loader.io/results/9fc6e5f2ac4f708b91a86095c13d8762" target="_blank"  style="padding: 0 10px 10px 0; font-family: Arial, 'Helvetica Neue', Helvetica, sans-serif; font-size: 14px;">View on loader.io</a>
</div></div>


<p></p>

<p>No error and response is steady.</p>

<h4>1000 concurrent request for 300 second</h4>

<div style="width: 600px;">
<iframe style="overflow: hidden;" scrolling="no" width='600' height='300' frameborder='0' src='//share.loader.io/results/36216016f1884328b0b0e71451adcc37/widget'></iframe>
<div style="width: 100%; text-align: right;">
<a href="http://loader.io/results/36216016f1884328b0b0e71451adcc37" target="_blank"  style="padding: 0 10px 10px 0; font-family: Arial, 'Helvetica Neue', Helvetica, sans-serif; font-size: 14px;">View on loader.io</a>
</div></div>


<h4>Conclusion</h4>

<p>First error start to occur when concurrent connection is about 815. The total error rate is 3% is not bad.
You can scale out by adding more container to your application. But from what I understand from their website seems you can only add 4 more containers to your app. So maximum is 5 containers per app. I am not sure it is a technical reason or you can add more by contacting Sqale.</p>

<p>It also seems that they will help you do some ddos mitigation behind the scene. After the c1k rush I cannot run a smaller test on it. All requests are timeout.</p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-03-19T19:06:00+08:00" data-updated="true" itemprop="datePublished">Mar 19<span>th</span>, 2013</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/ops/'>ops</a>, <a class='category' href='/blog/categories/sysadmin/'>sysadmin</a>, <a class='category' href='/blog/categories/vpn/'>vpn</a>, <a class='category' href='/blog/categories/vps/'>vps</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/03/19/softether-on-vps/" itemprop="url">SoftEther on VPS</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>I saw a post on <a href="http://www.lowendtalk.com/discussion/8783/softether-very-powerful-easy-to-use-multi-protocol-vpn-software">lowendtalk</a> last week introducing a new piece of vpn software call SoftEther.</p>

<h3>What is <a href="http://www.softether.org/">SoftEther</a></h3>

<p>A Free Cross-platform Multi-protocol VPN program,
as an academic project from <a href="http://www.tsukuba.ac.jp/english/">University of Tsukuba</a>.</p>

<p>It is a single server which support SSL-VPN (HTTPS) and 6 major VPN protocols (OpenVPN, IPsec, L2TP, MS-SSTP, L2TPv3 and EtherIP).</p>

<p>I would like to also highlight the <a href="http://www.softether.org/1-features/1._Ultimate_Powerful_VPN_Connectivity#1.6._VPN_over_ICMP.2C_and_VPN_over_DNS_(Awesome!)">VPN over ICMP and VPN over DNS</a> feature if you are inside a very strict network.</p>

<h3>VPS Setup Guide</h3>

<p>This post use SecureNAT. You may want to <a href="http://linc01n.github.io/blog/2013/05/17/softether-on-vps-using-local-bridge/">setup local bridge</a>.</p>

<blockquote><p>SoftEther author contacted me to highlight serveral points:</p>

<ul>
<li>On physical server, local bridge will perform better than SecureNAT</li>
<li><strong>DO NOT</strong> enable both local bridge and SecureNAT at the same time. Packets will loop infinitly and make your server <code>100%</code> CPU usage.</li>
</ul>
</blockquote>

<p>Requirement: VPS</p>

<p>I am using vps from buyvm. I got from a year deal which is USD12/year. I would recommend <a href="https://clientarea.ramnode.com/aff.php?aff=319">Ramnode</a> as a VPS provider. Their VPS is speedy and support is amazing.</p>

<ul>
<li>Spec:

<ul>
<li>RAM: 128MB</li>
<li>Burst: 256MB</li>
<li>Disk Space: 15GB</li>
<li>Bandwidth: 500GB</li>
<li>Location: Buffalo, USA</li>
</ul>
</li>
<li>OS:

<ul>
<li>Debian 6.0 64bit (minimal)</li>
</ul>
</li>
</ul>


<p>Make sure you login root as follow:</p>

<p><img src="/images/softether_vps/login.png" alt="login as root" /></p>

<p>Before installing SoftEther Server let us install some prerequisite.</p>

<figure class='code'><figcaption><span> (build_tools.sh)</span> <a href='/downloads/code/build_tools.sh'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>apt-get update
</span><span class='line'>apt-get install build-essential
</span></code></pre></td></tr></table></div></figure>


<p>Go to <a href="http://www.softether-download.com/en.aspx?product=softether">SoftEther</a> to download the server binary.</p>

<p><img src="/images/softether_vps/download_selection.png" alt="download selection" /></p>

<p>I am using Ver 1.00, Build 9029, rc2 in this tutorial.</p>

<p>After download, run</p>

<figure class='code'><figcaption><span> (make.sh)</span> <a href='/downloads/code/make.sh'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>tar zxf softether-vpnserver-v1.00-9029-rc2-2013.03.16-linux-x64-64bit.tar.gz
</span><span class='line'><span class="nb">cd </span>vpnserver
</span><span class='line'>make
</span></code></pre></td></tr></table></div></figure>


<p>Read the Agreement and press 1 three times.</p>

<p>Then we move the dir to /usr/local/</p>

<figure class='code'><figcaption><span> (install.sh)</span> <a href='/downloads/code/install.sh'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nb">cd</span> ..
</span><span class='line'>mv vpnserver /usr/local
</span><span class='line'><span class="nb">cd</span> /usr/local/vpnserver/
</span><span class='line'>chmod 600 *
</span><span class='line'>chmod 700 vpncmd
</span><span class='line'>chmod 700 vpnserver
</span><span class='line'>nano /etc/init.d/vpnserver
</span></code></pre></td></tr></table></div></figure>


<p>paste the following content to nano</p>

<figure class='code'><figcaption><span> (vpnserver.sh)</span> <a href='/downloads/code/vpnserver.sh'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="c">#!/bin/sh</span>
</span><span class='line'><span class="c">### BEGIN INIT INFO</span>
</span><span class='line'><span class="c"># Provides:          vpnserver</span>
</span><span class='line'><span class="c"># Required-Start:    $remote_fs $syslog</span>
</span><span class='line'><span class="c"># Required-Stop:     $remote_fs $syslog</span>
</span><span class='line'><span class="c"># Default-Start:     2 3 4 5</span>
</span><span class='line'><span class="c"># Default-Stop:      0 1 6</span>
</span><span class='line'><span class="c"># Short-Description: Start daemon at boot time</span>
</span><span class='line'><span class="c"># Description:       Enable Softether by daemon.</span>
</span><span class='line'><span class="c">### END INIT INFO</span>
</span><span class='line'><span class="nv">DAEMON</span><span class="o">=</span>/usr/local/vpnserver/vpnserver
</span><span class='line'><span class="nv">LOCK</span><span class="o">=</span>/var/lock/subsys/vpnserver
</span><span class='line'><span class="nb">test</span> -x <span class="nv">$DAEMON</span> <span class="o">||</span> <span class="nb">exit </span>0
</span><span class='line'><span class="k">case</span> <span class="s2">&quot;$1&quot;</span> in
</span><span class='line'>start<span class="o">)</span>
</span><span class='line'><span class="nv">$DAEMON</span> start
</span><span class='line'>touch <span class="nv">$LOCK</span>
</span><span class='line'>;;
</span><span class='line'>stop<span class="o">)</span>
</span><span class='line'><span class="nv">$DAEMON</span> stop
</span><span class='line'>rm <span class="nv">$LOCK</span>
</span><span class='line'>;;
</span><span class='line'>restart<span class="o">)</span>
</span><span class='line'><span class="nv">$DAEMON</span> stop
</span><span class='line'>sleep 3
</span><span class='line'><span class="nv">$DAEMON</span> start
</span><span class='line'>;;
</span><span class='line'>*<span class="o">)</span>
</span><span class='line'><span class="nb">echo</span> <span class="s2">&quot;Usage: $0 {start|stop|restart}&quot;</span>
</span><span class='line'><span class="nb">exit </span>1
</span><span class='line'><span class="k">esac</span>
</span><span class='line'><span class="nb">exit </span>0
</span></code></pre></td></tr></table></div></figure>


<p>ctrl-o ret ctrl-x</p>

<p>After that we enable the service</p>

<figure class='code'><figcaption><span> (service.sh)</span> <a href='/downloads/code/service.sh'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>chmod 755 /etc/init.d/vpnserver
</span><span class='line'>mkdir /var/lock/subsys
</span><span class='line'>update-rc.d vpnserver defaults
</span><span class='line'>/etc/init.d/vpnserver start
</span><span class='line'><span class="nb">cd</span> /usr/local/vpnserver/
</span></code></pre></td></tr></table></div></figure>


<p>Then we need to do a checking.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>./vpncmd
</span><span class='line'>3
</span><span class='line'>check</span></code></pre></td></tr></table></div></figure>


<p>You should get 4 &#8220;Pass&#8221;.</p>

<p>We need to set the server admin password</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>./vpncmd
</span><span class='line'>1
</span><span class='line'>ret
</span><span class='line'>ret
</span><span class='line'>VPN Server&gt;ServerPasswordSet</span></code></pre></td></tr></table></div></figure>


<p>Enter the admin password.</p>

<p>I do the setting on a windows client.
It is running</p>

<p><img src="/images/softether_vps/server_manager.png" alt="server manager" /></p>

<p>Install it, run it, click New setting. Input ip and password.</p>

<p><img src="/images/softether_vps/setting.png" alt="input setting" /></p>

<p>Then connect to it.
On successful login, it will pop up Easy Setup</p>

<p><img src="/images/softether_vps/easy_setup.png" alt="easy setup" />
Check Remote Access Server and Next</p>

<p><img src="/images/softether_vps/warning.png" alt="warning" /></p>

<p>Yes</p>

<p><img src="/images/softether_vps/virtual_hub.png" alt="Virtual Hub name" /></p>

<p>OK</p>

<p><img src="/images/softether_vps/l2tp.png" alt="Setup L2TP" />
Check Enable L2TP Server Function and input your own pre-share key</p>

<p>OK</p>

<p><img src="/images/softether_vps/azure.png" alt="Azure" />
We disable Azure VPN</p>

<p><img src="/images/softether_vps/create_user.png" alt="Create User" /></p>

<p>Then we need to create a new user. This is trivial.</p>

<p><img src="/images/softether_vps/user.png" alt="User" /></p>

<p><img src="/images/softether_vps/manager.png" alt="Manager" />
Click on &#8220;Manage Virtual Hub&#8221;</p>

<p>Click on &#8220;Secure NAT&#8221; (If you want a faster connection we can refer to my 2nd post on <a href="http://linc01n.github.io/blog/2013/05/17/softether-on-vps-using-local-bridge/">softether</a>)</p>

<p><img src="/images/softether_vps/secure_nat.png" alt="Secure NAT" /></p>

<p>Enable the Virtual NAT</p>

<blockquote><p>Again <strong>DO NOT</strong> enable SecureNAT and local bridge at the same time!</p></blockquote>

<h3>Done</h3>

<p>You can try to connect to the vpn server through L2TP/IPSec.</p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2011-10-18T17:38:00+08:00" data-updated="true" itemprop="datePublished">Oct 18<span>th</span>, 2011</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/coding/'>coding</a>, <a class='category' href='/blog/categories/django/'>django</a>, <a class='category' href='/blog/categories/python/'>python</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2011/10/18/django-admin-auto-select-current-user/" itemprop="url">Django Admin: Auto Select Current User</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<h2>Background</h2>

<p>There are often times in developing a CMS need to mark down who created the record. Django provide a nice admin interface for us. But when we only use the default, user need to select who they are by themselves. We want to auto select for them and they can&#8217;t pretend to be others.</p>

<h2>code</h2>

<p>In the django models.py, we have the following:</p>

<figure class='code'><figcaption><span>models.py  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">Notes</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span class='line'>    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>
</span><span class='line'>    <span class="n">content</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
</span><span class='line'>    <span class="n">date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateField</span><span class="p">()</span>
</span><span class='line'>    <span class="n">created_by</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">&quot;Created By&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>We want the created_by to be set automatically for the logged in user.</p>

<p>So in our admin:</p>

<figure class='code'><figcaption><span>admin  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">NotesAdmin</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">formfield_for_foreignkey</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db_field</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span class='line'>        <span class="k">if</span> <span class="n">db_field</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&#39;created_by&#39;</span><span class="p">:</span>
</span><span class='line'>            <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;queryset&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">username</span><span class="p">)</span>
</span><span class='line'>        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">NotesAdmin</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">formfield_for_foreignkey</span><span class="p">(</span><span class="n">db_field</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">get_readonly_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
</span><span class='line'>        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
</span><span class='line'>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">readonly_fields</span> <span class="o">+</span> <span class="p">(</span><span class="s">&#39;created_by&#39;</span><span class="p">,)</span>
</span><span class='line'>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">readonly_fields</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">add_view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">form_url</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">extra_context</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
</span><span class='line'>        <span class="n">data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span class='line'>        <span class="n">data</span><span class="p">[</span><span class="s">&#39;created_by&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
</span><span class='line'>        <span class="n">request</span><span class="o">.</span><span class="n">GET</span> <span class="o">=</span> <span class="n">data</span>
</span><span class='line'>        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">NotesAdmin</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">add_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">form_url</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">extra_context</span><span class="o">=</span><span class="n">extra_context</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Notes</span><span class="p">,</span> <span class="n">NotesAdmin</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h2>explanation</h2>

<p>The add_view function help us to select the current user from the drop-down list.</p>

<p>The formfield_for_foreignkey help us to filter out other users.</p>

<p>By combining this two function we get:</p>

<p><img src="/images/created_by.jpg" alt="Created By" /></p>

<p>The last get_readonly_fields function make this field can&#8217;t be edit after the creation.</p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2011-10-03T21:49:00+08:00" data-updated="true" itemprop="datePublished">Oct 3<span>rd</span>, 2011</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/mac/'>mac</a>, <a class='category' href='/blog/categories/osx/'>osx</a>, <a class='category' href='/blog/categories/windows/'>windows</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2011/10/03/synergey-key-mapping-between-mac-and-windows/" itemprop="url">Synergey Key Mapping Between Mac and Windows</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<h1>My Brain is going to Explode!</h1>

<p>Synergy is doing a great job about sharing keyboard and mouse between OSes. But when it comes to mac and windows, there are some new problems.</p>

<p>Mac and Windows have different keyboard shortcut. The most confusing shortcut fighting in my head is copy and paste. Synergy support copy and paste between machine which is nice. So I can copy some text from windows and paste them in mac.</p>

<p>Here comes the problem. I control-c in my windows and go to my Mac I hit control-v all the time. This is a vice versa problem. To solve it, I need to map control key to command key.</p>

<p>But setting up keybinding is hard in synergy. It is quite hard to make synergy working between my Mac Lion and Win 7. So I decided not to touch the config file of synergy.</p>

<h1>Solution: KeyRemap4MacBook</h1>

<p>Download from tekezo website: <a href="http://pqrs.org/macosx/keyremap4macbook/index.html">http://pqrs.org/macosx/keyremap4macbook/index.html</a></p>

<p>Direct Link : <a href="http://pqrs.org/macosx/keyremap4macbook/files/KeyRemap4MacBook-7.4.0.pkg.zip">http://pqrs.org/macosx/keyremap4macbook/files/KeyRemap4MacBook-7.4.0.pkg.zip</a></p>

<p>After installing the pkg and reboot, go to System Perferences->KeyRemap4MacBook.</p>

<p>Tick the following combobox:</p>

<ul>
<li>Shift_L to Lazy_Shift_L</li>
<li>Shift_R to Lazy_Shift_R</li>
<li>Option + Tab to Command + Tab</li>
<li>Use PC Style Copy/Paste</li>
<li>Use PC Style Undo</li>
<li>Use PC Style Select All</li>
<li>Use PC Style Save</li>
<li>Use PC Style Find</li>
<li>Use PC Style New Tab in Browser</li>
</ul>


<h1>Done</h1>

<p>Now I can use control-c and control-v in both of my machine. The shortcut won&#8217;t mess up my head anymore. :)</p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2011-09-28T12:31:00+08:00" data-updated="true" itemprop="datePublished">Sep 28<span>th</span>, 2011</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/development-setup/'>development setup</a>, <a class='category' href='/blog/categories/mac/'>mac</a>, <a class='category' href='/blog/categories/osx/'>osx</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2011/09/28/synergy-on-mac-osx-lion/" itemprop="url">Synergy on Mac OSX Lion</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p><em>Update the QuickSynergy Download link</em></p>

<h1>tl;dr</h1>

<h3>On Mac:</h3>

<p>Download: <a href="http://quicksynergy.googlecode.com/files/QuickSynergy.dmg">QuickSynergy for Mac</a></p>

<p>Setup the Windows Computer name or IP on the display edge in Quick Synergy.</p>

<p>Press Start.</p>

<h3>On Windows:</h3>

<p>Download: <a href="http://synergy.googlecode.com/files/synergy-1.3.7-Windows-x86.exe">Synergy 1.3.7</a></p>

<p>Install it and run it.</p>

<p>Type in the Mac IP in the &#8220;Other Computer&#8217;s Host Name&#8221;</p>

<h3>Done</h3>

<h1>Same mouse and keyboard for Mac and Windows</h1>

<p><a href="http://synergy-foss.org/">Synergy</a> is a software kvm. It can let you share same set of mouse and keyboard between two different computers through TCP/IP.</p>

<h2>Synergy 1.3.7</h2>

<p>I want to setup my Lion as server and Win7 as client. After trying with multiple combination of version and configuration, I found Quick Synergy can at least work.</p>

<p>Problems with 1.4.4 Beta Server on Lion is the keyboard can&#8217;t use the Shift key in Windows machine. Problmes with 1.3.7 Server is that I can make my keyboard work in Windows machine.</p>

<h2>Solutions</h2>

<p>Install Quick Synergy with the above instruction. Simple configuration and save all the hassle.</p>

		
		
	</div>

</article>

</div>
<nav id="pagenavi">
    
    
        <a href="/blog/page/2/" class="next">Next</a>
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav></div>
			</div>
			<footer id="footer" class="inner"><p>
  Copyright &copy; 2013 - Lincoln Lee -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

Design credit: <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a></footer>
			<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'linc01n';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



  <script type="text/javascript">
    var _gap = _gap || [];
    _gap.push(["_setAccount", 'UA-25566299-1']);
    _gap.push(['_trackPageview']);
    _gap.push(['_gapTrackBounceViaTime', 10]);
    _gap.push(['_gapTrackBounceViaScroll', 50]);
    _gap.push(['_gapTrackReads', 20, 30]);
    _gap.push(['_gapTrackLinkClicks']);
    _gap.push(['_gapTrackMaxScroll', 25]);


    (function() {
        var gap = document.createElement("script");
        gap.async = true;
        gap.type = "text/javascript";
        gap.src = "/javascripts/gap.min.js";

        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(gap, s);
    })();
  </script>




		</div>
	</div>
</body>
</html>
